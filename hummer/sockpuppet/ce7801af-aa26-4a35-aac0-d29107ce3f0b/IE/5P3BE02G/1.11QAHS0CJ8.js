KISSY.add("malldetail/sku/progressive",function(e,t,a){return{"init":function(i){var n=this;codeTrack("trade.progressive.init","trade.sku.focus");var o=i.product,r=i.el;o.onLoad(["progressiveInfo","config","serverStartTime"],function(i,l,s){function c(){t.query("li.hidden",r).length==b?t.hide(r):t.show(r)}if(!i||i.tryBeforeBuy||!i.extInfos||!i.extInfos.installFee||!i.show)return void t.hide(r);var d,u=i.extInfos.bizType,m={"-1":'<a href="//service.tmall.com/support/tmall/knowledge-6703284.htm" target="_blank">\u4ec0\u4e48\u662f\u82b1\u5457\u5206\u671f</a>',"0":'<a href="javascript:;" id="J_magicBoxLogin">\u767b\u5f55</a>\u540e\u786e\u8ba4\u662f\u5426\u4eab\u6709\u8be5\u670d\u52a1 <a href="//service.tmall.com/support/tmall/knowledge-6703284.htm" target="_blank">\u4ec0\u4e48\u662f\u82b1\u5457\u5206\u671f</a>',"2":'\u60a8\u53ef\u83b7\u53d6\u5927\u989d\u5b89\u5bb6\u989d\u5ea6\u5566\uff0c<a href="javascript:void(0)">\u7acb\u5373\u9886\u53d6</a>',"3":'\u8d76\u5feb\u4f7f\u7528\u60a8\u7684\u5927\u989d\u5b89\u5bb6\u989d\u5ea6\u5427\uff0c<a href="javascript:void(0)">\u67e5\u770b\u989d\u5ea6\u548c\u6709\u6548\u671f</a>',"4":'\u6fc0\u6d3b\u5929\u732b\u4f1a\u5458\u540e\u5373\u53ef\u4eab\u53d7\u82b1\u5457\u5206\u671f\u4e70\u670d\u52a1\uff0c<a id="J_activeTMember_Now" href="//vip.tmall.com/?layer=activation" target="_blank">\u7acb\u5373\u6fc0\u6d3b\u4f1a\u5458</a>',"6":'\u652f\u4ed8\u5c3e\u6b3e\u65f6\u53ef\u4ee5\u7528\u4ee5\u4e0b\u82b1\u5457\u5206\u671f\uff1a <a href="//service.tmall.com/support/tmall/knowledge-6703284.htm" target="_blank">\u4ec0\u4e48\u662f\u82b1\u5457\u5206\u671f</a>'};if(i.newPCInstallment){var p=t.get("dd",r);t.addClass(p,"text");var f="";f=0==u||4==u?m[u]:'\u8bf7\u5728\u4e0b\u5355\u9875\u9762\u9009\u62e9\u5206\u671f\u65b9\u5f0f <a href="//service.tmall.com/support/tmall/knowledge-6703284.htm" target="_blank">\u4ec0\u4e48\u662f\u82b1\u5457\u5206\u671f</a>';var h,g=s||(new Date).getTime();h=g>=new Date(2015,10,1,0,0,0).getTime()&&g<=new Date(2015,10,11,23,59,59).getTime()?i.text?'<div><p class="info double11"><i class="top"></i>'+i.text+'<i class="bottom"></i></p><p>'+f+"</p></div>":"<div><p>"+f+"</p></div>":i.text?'<div><p class="info"><i class="huabei"></i>'+i.text+"</p><p>"+f+"</p></div>":"<div><p>"+f+"</p></div>",t.html(p,h),t.show(r);var v=t.get("#J_magicBoxLogin",d);return v&&a.on(v,"click",function(){TShop.onLogin(function(){window.location.reload()})}),!1}if(l.itemDO.isHotItem)return void n.hotItemProgressive(i,l,r);t.remove(t.query("li",t.get("ul",r)));var b=0;if(e.each(i.extInfos.installFee,function(e,a){if(!(parseInt(a,10)<=2)){var i=t.create('<li data-key="'+a+'" class="progressive-item"><a href="#"><span class="j-content"></span></a><i>\u5df2\u9009\u4e2d</i></li>');t.append(i,t.get("ul",r)),b++}}),o.addBuyValidator(function(e,t){if(t(),1!=e.type)return void TShop.sendAtpanel("tmalljy.3.1",{"action":"detail_cartclick","userType":u});o.onLoad("currentProgressive",function(e){e?TShop.sendAtpanel("tmalljy.3.1",{"action":"detail_fqgclick_"+e.type,"userType":u}):TShop.sendAtpanel("tmalljy.3.1",{"action":"detail_buynowclick","userType":u})})},1),!m[u])return void t.hide(r);d=t.create('<div class="mui-msg mui-msg-clean"><div class="mui-msg-con mui-msg-attention">'+m[u]+'<s class="mui-msg-icon"></s></div></div>'),t.insertBefore(d,t.get("ul",r));var v=t.get("#J_magicBoxLogin",d);if(v&&a.on(v,"click",function(){TShop.onLogin(function(){window.location.reload()})}),i.text){var p=t.get("dd div",r),h=t.create('<div class="huabeilabel"><p class="info"><i class="huabei"></i>'+i.text+"</p></div>");t.insertBefore(h,p)}t.show(r),codeTrack("trade.progressive.show","trade.progressive.init"),a.delegate(t.get("ul",r),"click","li",function(e){return!t.hasClass(e.currentTarget,"tb-out-of-stock")&&(t.hasClass(e.currentTarget,"tb-selected")?(o.set("progressiveType",""),TShop.sendAtpanel("tmalljy.3.1",{"action":"detail_fqguserunselect_"+t.attr(e.currentTarget,"data-key"),"userType":u})):(o.set("progressiveType",t.attr(e.currentTarget,"data-key")),TShop.sendAtpanel("tmalljy.3.1",{"action":"detail_fqguserselect_"+t.attr(e.currentTarget,"data-key"),"userType":u})),codeTrack("trade.progressive.click","trade.progressive.show"),!1)}),o.onChange("currentProgressive",function(a){e.each(t.query("li",r),function(e){var i=t.attr(e,"data-key");a&&a.type==i?t.addClass(e,"tb-selected"):t.removeClass(e,"tb-selected")})}),o.onChange(["totalPrice","progressiveInfo","currentWrtInfo"],function(a,i,n){i.enable?e.each(t.query("li",r),function(e){"11p"===t.attr(e,"data-key")&&t.addClass(e,"db11NoFee")}):t.addClass(t.query("li",r),"tb-out-of-stock"),e.each(t.query("li",r),function(e,a){var r=t.attr(e,"data-key");o.onProgressive(r,function(r){if(!r)return void(t.hasClass("hidden")||(t.addClass(e,"hidden"),c()));r&&!1!==r.enabled?(t.removeClass(e,"tb-out-of-stock"),i.double11Privilege===a&&t.addClass(e,"tm-db11NoFee")):(t.addClass(e,"tb-out-of-stock"),i.double11Privilege==a&&t.removeClass(e,"db11NoFee")),r&&!0===r.couponVisable?t.addClass(e,"couponVisable"):t.removeClass(e,"couponVisable"),t.html(t.get("span",e),'<span class="tm-msg"><em>\xa5</em><strong>'+r.minPrice+(r.minPrice!==r.maxPrice?"\u8d77":"")+"</strong>x"+r.stages+'\u671f</span><br><span class="tm-feeDesc">('+(0===r.rate?"<strong>0</strong>":"\u542b")+"\u624b\u7eed\u8d39)</span>"+(r.couponVisable&&r.coupon?'<span class="coupon-txt">'+r.coupon+"</span>":"")),t.hasClass(e,"hidden")&&(t.removeClass(e,"hidden"),c()),n&&o.onWrtProgressive(n,r,function(a){if(!a)return!1;t.html(t.get(".j-content",e),'<span class="tm-msg"><em>\xa5</em><strong>'+a.minPrice+(a.minPrice!==a.maxPrice?"\u8d77":"")+"</strong>x"+a.stages+'\u671f</span><br><span class="tm-feeDesc">('+(0===a.rate?"<strong>0</strong>":"\u542b")+"\u624b\u7eed\u8d39)</span>"+(r.couponVisable&&r.coupon?'<span class="coupon-txt">'+r.coupon+"</span>":""))})})})})}),o.onChange(["currentProgressive","config"],function(i,n){if(i){if(!t.get(".tm-pg-price")){var r=t.create('<dl class="tm-pg-price"><dt class="tb-metatit">\u5206\u671f\u4ef7<a class="tm-pg-why" href="//service.taobao.com/support/help-16825.htm" target="_blank">?</a><div class="mui-msg tm-pg-answer"><div class="mui-msg-con mui-msg-tip">\u82b1\u5457\u5206\u671f\uff0c\u662f\u7531\u5929\u732b\u8054\u5408\u5546\u5bb6\u5171\u540c\u63a8\u51fa\u7684\u8d4a\u8d2d\u670d\u52a1\uff0c\u901a\u8fc7\u652f\u4ed8\u5b9d\u8f7b\u677e\u8fd8\u6b3e\u3002<s class="mui-msg-icon"></s></div><s class="mui-msg-arrow mui-msg-arrow-top"></s></div></dt><dd><em class="J_prgMoney"></em><a class="tm-pg-liyi" href="//service.taobao.com/support/help-16825.htm" target="_blank">(0\u9996\u4ed8\u30010\u624b\u7eed\u8d39)</a></dd></dl>');o.onLoad("currentPromotionList",function(e){!e||!e[0]||e[0].limitTime&&!1===e[0].start?t.insertAfter(r,"#J_StrPriceModBox"):t.insertAfter(r,"#J_PromoPrice"),a.on(".tm-pg-why","mouseover touchstart",function(){t.show(".tm-pg-answer")}),a.on(".tm-pg-why","mouseout touchend",function(){t.hide(".tm-pg-answer")})})}0===i.rate?t.show(".tm-pg-liyi"):t.hide(".tm-pg-liyi"),t.html(".J_prgMoney","<em>\xa5</em>"+i.minPrice+(i.maxPrice!==i.minPrice?"\u8d77":"")+"<span>X"+i.stages+"\u671f</span>"),t.html(t.get("#J_LinkBuy"),'\u5206\u671f\u8d2d\u4e70<span class="ensureText">\u786e\u8ba4</span>'),t.show(".tm-pg-price")}else t.hide(".tm-pg-price"),n.detail.isPrescriptionDrug||n.detail.isOtcDrug?t.html(t.get("#J_LinkBuy"),'\u63d0\u4ea4\u9700\u6c42<span class="ensureText">\u786e\u8ba4</span>'):t.html(t.get("#J_LinkBuy"),'\u7acb\u5373\u8d2d\u4e70<span class="ensureText">\u786e\u8ba4</span>');if(o.onLoad(["itemPrice","currentWrtInfo"],function(e,a){if(e&&a&&0!==a.status){var i="\u7acb\u5373\u4ed8\u5b9a\u91d1";a.priceRange||(i=i+"&yen;"+a.prePayFee),i+='<span class="ensureText">\u786e\u8ba4</span>',t.html(t.get("#J_LinkBuy"),i),t.hide(".tm-pg-price")}}),6===e.UA.ie){var l="ie6-"+Math.random();e.one(".tm-fcs-panel").addClass(l).removeClass(l)}})},"hotItemProgressive":function(e,a,i){t.removeClass(i,"tb-hidden"),t.addClass(document.body,"tm-hotItem");var n=t.create('<span>\u8be5\u5546\u54c1\u652f\u6301\u82b1\u5457\u5206\u671f <a href="//service.tmall.com/support/tmall/knowledge-6703284.htm" target="_blank">\u4ec0\u4e48\u662f\u82b1\u5457\u5206\u671f</a>?</span>');t.insertBefore(n,t.get("ul",i))}}},{"requires":["dom","event","malldetail/sku/progressive.css","ua"]});