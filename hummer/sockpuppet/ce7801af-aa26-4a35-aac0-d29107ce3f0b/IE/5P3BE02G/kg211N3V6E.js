define("kg/imagezoom/2.0.1/index",["node","kg/overlay/6.1.3/index","base","util"],function(e,t,i){var n,o=e("node"),a=e("kg/overlay/6.1.3/index"),g=e("base"),s=e("util");n=function(e){function t(e,t,i){return Math.min(Math.max(e,t),i)}function i(e){i.superclass.constructor.call(this,e),this.Zoomer=null,this.config=e,this._init()}function n(e){var t,i,n,o,a,g,s,m,r,h,u=L(e.get("imageNode")),c=u.offset(),l=e.get("bigImageWidth"),f=e.get("bigImageHeight"),p=e.get("width"),I=e.get("height");t=e.imageLeft=c.left,h=e.imageTop=c.top,i=e.imageWidth=u.width(),n=e.imageHeight=u.height(),o=e.zoomMultipleH=f/n,a=e.zoomMultipleW=l/i,g=e.lensWidth=p/a,s=e.lensHeight=I/o,e.minLensLeft=t,e.minLensTop=h,e.maxLensTop=h+n-s,e.maxLensLeft=t+i-g,e.maxBigImageLeft=0,e.maxBigImageTop=0,e.minBigImageLeft=-(l-p),e.minBigImageTop=-(f-I),e.get("type")===z?e.Zoomer.set("align",{node:u,points:["cc","cc"]}):(m=e.Zoomer.get("align")||{},r=m.node,delete m.node,m=x.clone(m),m.node=r||u,e.Zoomer.set("align",m)),e.icon.hide(),Z.on("mousemove mouseleave",d,e)}function m(){var e=this,t=e.lens;Z.detach("mousemove mouseleave",d,e),e.icon.show(),t&&t.hide()}function r(e){var t,i,n=L(e.get("imageNode"));t=e.imageWrap=L(x.substitute(H,{wrapClass:e.get("prefixCls")+"imagezoom-wrap"})).insertBefore(n,W),t.prepend(n),i=e.icon=L(x.substitute(T,{iconClass:e.get("prefixCls")+"imagezoom-icon"})),t.append(i),h(e)}function h(e){e.get("type")!=z&&(e.lens=L("<span "+M+' class="'+e.get("prefixCls")+'imagezoom-lens"></span>').appendTo(e.imageWrap,void 0))}function u(e){var t=L(e.get("imageNode")),i=e.get("width"),n=e.get("height");e.Zoomer=new w({elCls:"ks-imagezoom-viewer",align:e.get("align"),width:i,height:n}),e.Zoomer.render(),e.Zoomer.on("hide",m,e);var o=e.Zoomer.get("contentEl");e.bigImage=L(x.substitute(S,{src:e.get("bigImageSrc"),style:M})).appendTo(o,void 0),e.bigImageCopy=L(x.substitute(S,{src:t.attr("src"),style:M})).prependTo(o,void 0),e.bigImageCopy.css({width:e.get("bigImageWidth"),height:e.get("bigImageHeight")})}function c(e){var t,i=L(e.get("imageNode")),o=e.get("type"),a=function(){function o(){a||(a=x.later(function(){a=0,l(i),n(e),e.Zoomer.show(),e.lens.show().css({width:e.lensWidth,height:e.lensHeight}),e.fire("currentMouseChange",t)},50))}var a;return o.stop=function(){a.cancel(),a=0},o}(),g=x.buffer(function(){l(i),n(e),e.Zoomer.show(),f(e,.4,t)},50),s="inner"==o?g:a;i.on("mouseenter",e.__onImgEnter=function(n){!e.Zoomer&&e.get("hasZoom")&&u(e),e.get("hasZoom")&&(t=n,i.on("mousemove"+B,function(e){t=e,s()}).on("mouseleave"+B,function(){s.stop(),l(i)}),s())}),e.on("afterImageSrcChange",I,e),e.on("afterHasZoomChange",p,e),p.call(e,{newVal:e.get("hasZoom")})}function l(e){e.detach("mouseleave"+B),e.detach("mousemove"+B)}function d(e){var t=this,i=t.imageLeft,n=t.imageTop,o=t.imageWidth,a=e.pageX,g=e.pageY,s=t.imageHeight;return"mouseleave"==String(e.type)?void t.Zoomer.hide():void(a>i&&a<i+o&&g>n&&g<n+s?t.fire("currentMouseChange",{pageX:a,pageY:g}):t.Zoomer.hide())}function f(e,t,i){var n=e.bigImage;n.add(e.bigImageCopy),n.stop(),n.css({width:e.imageWidth,height:e.imageHeight,left:0,top:0}),n.animate(x.mix({width:e.get("bigImageWidth"),height:e.get("bigImageHeight")},v(e,i)),t)}function p(e){this.icon[e.newVal?"show":"hide"]()}function I(e){var t,i=e.newVal,n=this;L(n.get("imageNode")).attr("src",i),(t=n.bigImageCopy)&&t.attr("src",i)}function v(e,i){var n=e.get("width"),o=e.get("height");return{left:t(-(i.pageX-e.imageLeft)*e.zoomMultipleW+n/2,e.minBigImageLeft,e.maxBigImageLeft),top:t(-(i.pageY-e.imageTop)*e.zoomMultipleH+o/2,e.minBigImageTop,e.maxBigImageTop)}}var b=o,w=a,C=g,x=s,y=KISSY,L=b.all,Z=L(y.Env.host.document),T="<span class='{iconClass}'></span>",W=void 0,H="<span class='{wrapClass}'></span>",N="standard",B=".ks-imagezoom-img-mouse",z="inner",M=' style="position:absolute;top:-9999px;left:-9999px;" ',S="<img src={src} {style} />";return x.extend(i,C,{_init:function(){var e=this;e.config.bigImageWidth&&e.config.bigImageHeight||y.error("bigImageWidth/bigImageHeight in ImageZoom must be set!"),e._renderUI(),e._bindEvents()},_renderUI:function(){var e=this;r(e),c(e)},_bindEvents:function(){var e=this;e.on("currentMouseChange",function(i){var n,o,a,g=i.pageX,s=i.pageY,m=e.lens;e.bigImage.isRunning()||(m&&(n=g-e.lensWidth/2,o=s-e.lensHeight/2,m.offset({left:e.lensLeft=t(n,e.minLensLeft,e.maxLensLeft),top:e.lensTop=t(o,e.minLensTop,e.maxLensTop)})),a=v(e,i),e.bigImageCopy.css(a),e.bigImage.css(a))}),e.on("afterBigImageWidthChange",function(e){var t=this;t.bigImage&&(t.bigImage.width(e.newVal),t.bigImageCopy.width(e.newVal))}),e.on("afterBigImageHeightChange",function(e){var t=this;t.bigImage&&(t.bigImage.height(e.newVal),t.bigImageCopy.height(e.newVal))}),e.on("afterBigImageSrcChange",function(t){e.bigImage&&e.bigImage.attr("src",t.newVal)})},destroy:function(){var e,t=this,i=t.get("imageNode");m.call(t),(e=t.imageWrap)&&(i.insertBefore(e,W),e.remove()),i.detach("mouseenter",t.__onImgEnter)}},{xclass:"imagezoom-